language: c

deploy:
  provider: releases
  api_key: "GITHUB OAUTH TOKEN"
  file: travis_test.tar.bz2
  skip_cleanup: true
  on:
    tags: true

before_script:
  - env
  - gem install rubyzip
  - gem install git
  - 'ZIPNAME=$(ruby dist/ci_zipname.rb)'
  - echo ZIPNAME=${ZIPNAME}

script:
  - ruby dist/ci_fetchsubmodule.rb dist/submodules.json
  - mkdir ~/${ZIPNAME}
  - cp -r * ~/${ZIPNAME}
  - bash -c "cd ~ && tar cfj travis_test.tar.bz2 --exclude ${ZIPNAME}/.git ${ZIPNAME}/"
